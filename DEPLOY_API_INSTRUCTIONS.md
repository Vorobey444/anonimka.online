# üöÄ –î–µ–ø–ª–æ–π API world-chat –Ω–∞ Vercel

## –®–∞–≥ 1: –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤ Neon Database

API `/api/world-chat` —Ç—Ä–µ–±—É–µ—Ç –∫–æ–ª–æ–Ω–∫—É `is_bot` –≤ —Ç–∞–±–ª–∏—Ü–µ `world_chat_messages`.

### –í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ Neon Console (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –û—Ç–∫—Ä–æ–π https://console.neon.tech
2. –í—ã–±–µ—Ä–∏ —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π–¥–∏ –≤ **SQL Editor**
4. –°–∫–æ–ø–∏—Ä—É–π –∏ –≤—ã–ø–æ–ª–Ω–∏:

```sql
-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è is_bot –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ç–∞–±–ª–∏—Ü–µ world_chat_messages
ALTER TABLE world_chat_messages 
ADD COLUMN IF NOT EXISTS is_bot BOOLEAN DEFAULT FALSE;

-- –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
CREATE INDEX IF NOT EXISTS idx_world_chat_is_bot ON world_chat_messages(is_bot);

-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
COMMENT ON COLUMN world_chat_messages.is_bot IS 'TRUE –µ—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –±–æ—Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏';
```

5. –ù–∞–∂–º–∏ **Run** ‚úÖ

### –í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ API migrate (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω)

```bash
curl -X POST https://anonimka.kz/api/migrate \
  -H "Content-Type: application/json" \
  -d '{"migration": "014_add_is_bot"}'
```

---

## –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–ø–ª–æ–π –Ω–∞ Vercel

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: API —É–∂–µ –Ω–∞ Vercel?

–§–∞–π–ª `pages/api/world-chat.js` —É–∂–µ –≤ –∫–æ–¥–µ –∏ –∑–∞–∫–æ–º–º–∏—á–µ–Ω –≤ git (–∫–æ–º–º–∏—Ç `9b7ccbd`).

Vercel **–¥–æ–ª–∂–µ–Ω –±—ã–ª** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å –ø—Ä–∏ push.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –¢–µ—Å—Ç–∏—Ä—É–µ–º API

```bash
# GET –∑–∞–ø—Ä–æ—Å
curl "https://anonimka.kz/api/world-chat?type=world&limit=5"

# POST –∑–∞–ø—Ä–æ—Å (—Ç–µ—Å—Ç)
curl -X POST https://anonimka.kz/api/world-chat \
  -H "Content-Type: application/json" \
  -d '{
    "user_token": "test_bot_123",
    "nickname": "TestBot",
    "message": "–ü—Ä–æ–≤–µ—Ä–∫–∞ API",
    "type": "world",
    "is_bot": true
  }'
```

**–ï—Å–ª–∏ –ø–æ–ª—É—á–∞–µ—à—å 404/405** - –∑–Ω–∞—á–∏—Ç Vercel –Ω–µ –ø–æ–¥—Ö–≤–∞—Ç–∏–ª –∏–∑–º–µ–Ω–µ–Ω–∏—è.

---

## –®–∞–≥ 3: –§–æ—Ä—Å–∏—Ä–æ–≤–∞—Ç—å –¥–µ–ø–ª–æ–π –Ω–∞ Vercel

### –í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ Vercel Dashboard

1. –û—Ç–∫—Ä–æ–π https://vercel.com/dashboard
2. –ù–∞–π–¥–∏ –ø—Ä–æ–µ–∫—Ç **anonimka-nextjs** (–∏–ª–∏ –∫–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è)
3. –ü–µ—Ä–µ–π–¥–∏ –≤ **Deployments**
4. –ù–∞–π–¥–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–ø–ª–æ–π —Å –∫–æ–º–º–∏—Ç–æ–º `9b7ccbd`
5. –ï—Å–ª–∏ –¥–µ–ø–ª–æ–π –µ—Å—Ç—å, –Ω–æ API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –Ω–∞–∂–º–∏ **Redeploy**
6. –ï—Å–ª–∏ –¥–µ–ø–ª–æ—è –Ω–µ—Ç - –∑–Ω–∞—á–∏—Ç –ø—Ä–æ–µ–∫—Ç –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é

### –í–∞—Ä–∏–∞–Ω—Ç B: –§–æ—Ä—Å–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ git

```bash
cd "e:\my project\app chat\anonimka-nextjs"

# –ü—É—Å—Ç–æ–π –∫–æ–º–º–∏—Ç –¥–ª—è —Ç—Ä–∏–≥–≥–µ—Ä–∞ –¥–µ–ø–ª–æ—è
git commit --allow-empty -m "Force redeploy: world-chat API"
git push origin main
```

Vercel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç –¥–µ–ø–ª–æ–π.

### –í–∞—Ä–∏–∞–Ω—Ç C: –ß–µ—Ä–µ–∑ Vercel CLI (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)

```bash
cd "e:\my project\app chat\anonimka-nextjs"
vercel --prod
```

---

## –®–∞–≥ 4: –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ API:

```bash
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 200 –∏ —Å–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π
curl "https://anonimka.kz/api/world-chat?type=world&limit=5"
```

### –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –ª–æ–∫–∞–ª—å–Ω–æ:

1. –£–±–µ–¥–∏—Å—å —á—Ç–æ `.env` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω:
   ```
   VERCEL_API_URL=https://anonimka.kz
   ```

2. –ó–∞–ø—É—Å—Ç–∏ –±–æ—Ç–∞:
   ```
   cd "e:\my project\app chat\anon-board-bot"
   .\start_activity_bot.bat
   ```

3. –ë–æ—Ç –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ç–≤–æ–µ–≥–æ –∫–æ–º–ø–∞ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä

---

## –ü—Ä–æ–±–ª–µ–º—ã?

### "API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 404"
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Ñ–∞–π–ª `pages/api/world-chat.js` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- –ü—Ä–æ–≤–µ—Ä—å Vercel Dashboard - –µ—Å—Ç—å –ª–∏ —É—Å–ø–µ—à–Ω—ã–π –¥–µ–ø–ª–æ–π?
- –ü–æ–ø—Ä–æ–±—É–π Redeploy –≤ Vercel

### "–û—à–∏–±–∫–∞ —Å –∫–æ–ª–æ–Ω–∫–æ–π is_bot"
- –í—ã–ø–æ–ª–Ω–∏ –º–∏–≥—Ä–∞—Ü–∏—é SQL (–®–∞–≥ 1)
- –ü—Ä–æ–≤–µ—Ä—å —á–µ—Ä–µ–∑ Neon Console: `SELECT * FROM world_chat_messages LIMIT 1;`

### "Connection refused"
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –±–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL –≤ `.env`
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Å–µ—Ä–≤–µ—Ä anonimka.kz –¥–æ—Å—Ç—É–ø–µ–Ω

---

## –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:

‚úÖ API –∫–æ–¥ –≥–æ—Ç–æ–≤ (`pages/api/world-chat.js`)
‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è SQL –≥–æ—Ç–æ–≤–∞ (`migrations/014_add_is_bot.sql`)
‚úÖ –ö–æ–¥ –∑–∞–∫–æ–º–º–∏—á–µ–Ω –≤ git (–∫–æ–º–º–∏—Ç `9b7ccbd`)
‚è≥ **–ù—É–∂–Ω–æ:** –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é SQL –≤ Neon
‚è≥ **–ù—É–∂–Ω–æ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–ø–ª–æ–π –Ω–∞ Vercel (—Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ —É–∂–µ –∑–∞–¥–µ–ø–ª–æ–µ–Ω)

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –±–æ—Ç –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç! üöÄ
